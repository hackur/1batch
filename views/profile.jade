extends ./layout.jade

block content
  input.csrf(type="hidden", value=csrfToken)
  input.username(type="hidden", value=user.name)

  .row
    .col-sm-12.underbar
      if forUser
        a.btn.btn-info.pull-right(href="/logout") Log Out
      else
        a.btn.btn-primary.pull-right(href="/profile") Log In
      h2
        a(href="/feed") 1batch
        small &nbsp;an app for sharing 8 photos
  .row
    .col-sm-12.col-md-6
      h1= user.name
      if posted
        h4 posted #{posted}
      else
        if forUser && user.name == forUser.name
          h4 You haven't posted yet!
        else
          h4 hasn't posted yet!
      if forUser
        if forUser.name !== user.name
          if following
            button.btn.btn-danger.follow Unfollow
          else
            button.btn.btn-success.follow Follow
  if posted
    .row.profilephotos
      for index in [0, 1, 2, 3]
        if index < images.length
          .col-sm-6.col-lg-3
            a.pcon(href="/#{user.name}/photo/#{images[index]._id}")
              img(src=images[index].src.main, srcset="#{images[index].src.main} 1x, #{images[index].src.retina} 2x", class="#{images[index].hidden ? 'hidden' : ''}")
    .row.profilephotos
      for index in [4, 5, 6, 7]
        if index < images.length
          .col-sm-6.col-lg-3
            a.pcon(href="/#{user.name}/photo/#{images[index]._id}")
              img(src=images[index].src.main, srcset="#{images[index].src.main} 1x, #{images[index].src.retina} 2x", class="#{images[index].hidden ? 'hidden' : ''}")
  else
    if forUser && user.name == forUser.name
      .row
        .col-sm-12.col-md-6
          form.well(action="/upload?_csrf=#{csrfToken}", method="POST", enctype="multipart/form-data")
            label Upload a photo that you might use. You can change your mind before posting.
            hr
            input(type="file", name="upload")
            button.btn.btn-success.pull-right Upload
            .clearfix
      .row
        .col-sm-12.savedphotos
          if saved.length
            h4
              span Saved images (
              span.pickcount
              span &nbsp;/ 8 picked)
            for image in saved
              .col-sm-6.col-lg-4
                a.pcon(href="javascript:void(0);", class="#{image.picked ? 'picked' : ''}")
                  img(id=image._id, src=image.src.main, srcset="#{image.src.main} 1x, #{image.src.retina} 2x")
                  span.pick
                    if !image.picked
                      button Pick &check;
                    else
                      button Remove x
          else
            p No images uploaded yet...
      if saved.length
        .row
          .col-sm-12.postnow
            hr
            button.btn.btn-success Publish Picked Photos
      else if (posted.indexOf('minutes') > -1 || posted.indexOf('seconds') > -1)
        .row
          .col-sm-12.postnow
            hr
            button.btn.btn-danger Unpublish Photos

block scripts
  script(type="text/javascript", src="/lib/jquery-1.11.3.min.js")
  script(type="text/javascript", src="/follow-button.js")
  script(type="text/javascript", src="/image-select.js")
